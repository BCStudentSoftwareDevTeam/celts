{% set title = "Download Reports" %}
{% extends "base.html" %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" type="text/css" href="/static/css/reports.css"></link>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="/static/js/reports.js"></script>

<script>
    // Set the form action based on which button is clicked
    document.getElementById('download-btn').addEventListener('click', function() {
        document.getElementById('reportForm').action = '/admin/reports/download';
    });

    document.getElementById('visualize-btn').addEventListener('click', function() {
        document.getElementById('reportForm').action = '/admin/reports/visualize';
    });
</script>
{% endblock %}

{% block app_content %}
<div class="download-container mt-50 text-center d-flex flex-column align-items-center">
    <h1 class="mb-3">Annual Report</h1>
    <form id="reportForm" method="post" class="form-group col-md-6 d-flex flex-column align-items-center">
        <div class="d-flex flex-column text-center justify-content-center align-items-center">
            <div class="col-12 col-md-10 mb-3 d-flex justify-content-center">
                <select id="academicYear" name="academicYear" class="form-select w-100" 
                        style="max-width: 700px; min-width: 280px; padding: 10px; font-size: 16px;" required>
                    <option value="" disabled selected>Select an academic year</option>
                    {% for year in academicYears %}
                        <option value="{{ year }}">{{ year }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="d-flex gap-3 justify-content-between">
                <!-- Download Button -->
                <button type="submit" class="btn btn-primary btn-m d-flex justify-content-center align-items-center" style="max-width: 200px;" id="download-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="20" height="20" viewBox="0 0 48 48">
                        <defs>
                            <linearGradient id="G7C1BuhajJQaEWHVlNUzHa_BEMhRoRy403e_gr1" x1="6" x2="27" y1="24" y2="24" data-name="Gradient" gradientUnits="userSpaceOnUse">
                                <stop offset="0" stop-color="#21ad64"></stop>
                                <stop offset="1" stop-color="#088242"></stop>
                            </linearGradient>
                        </defs>
                        <path fill="#31c447" d="m41,10h-16v28h16c.55,0,1-.45,1-1V11c0-.55-.45-1-1-1Z"></path>
                        <path fill="#fff" d="m32,15h7v3h-7v-3Zm0,10h7v3h-7v-3Zm0,5h7v3h-7v-3Zm0-10h7v3h-7v-3Zm-7-5h5v3h-5v-3Zm0,10h5v3h-5v-3Zm0,5h5v3h-5v-3Zm0-10h5v3h-5v-3Z"></path>
                        <path fill="url(#G7C1BuhajJQaEWHVlNUzHa_BEMhRoRy403e_gr1)" d="m27,42l-21-4V10l21-4v36Z"></path>
                        <path fill="#fff" d="m19.13,31l-2.41-4.56c-.09-.17-.19-.48-.28-.94h-.04c-.05.22-.15.54-.32.98l-2.42,4.52h-3.76l4.46-7-4.08-7h3.84l2,4.2c.16.33.3.73.42,1.18h.04c.08-.27.22-.68.44-1.22l2.23-4.16h3.51l-4.2,6.94,4.32,7.06h-3.74Z"></path>
                    </svg>
                    <p class="mb-0 py-0 ms-2">Download</p>
                </button>

                <!-- Visualize Button -->
                <button type="submit" class="btn btn-primary btn-m d-flex justify-content-center align-items-center" style="max-width: 200px;" id="visualize-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 48 48">
                        <circle fill="#FF7D5F" cx="24" cy="24" r="11.722"></circle>
                        <path fill="#FFDA88" d="M15 19l6 10-6 10H15z"></path>
                    </svg>
                    <p class="mb-0 py-0 ms-2">Visualize</p>
                </button>
            </div>
        </div>
    </form>
</div>

<div id="viz-modal" class="viz-modal">
    <div class="viz-modal-content">
        <button id="close-viz-modal" class="close-viz-modal">&times;</button>
        <div class="visualization-container">
            <div class="row d-flex justify-content-center">
                <div class="col-12 col-md-6 visualiztion-div">
                    <canvas id="chart1" class="chart-canvas"></canvas>
                </div>
                <div class="row d-flex justify-content-center">
                    <div class="col-12 col-md-6 visualiztion-div">
                        <canvas id="chart2" class="chart-canvas"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.chart-canvas {
    width: 100% !important; /* Ensures canvas takes full width of its container */
    max-width: 500px; /* Optional: set a max width to maintain the aspect ratio */
    aspect-ratio: 1 / 1; /* Ensures a perfect square canvas for pie charts */
}
</style>
{% endblock %}
