{% extends "base.html"%}
{% block scripts %}
  {{super()}}
  <script src="/static/js/createEvents.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>

{% endblock %}

{% block styles %}
  {{super()}}
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">

{% endblock %}

{% block app_content %}

  <div align="center" style="margin-bottom: 50px;">
    <h1 id ="title">{{program.programName}}</h1>
    {% if user.isCeltsAdmin or user.isCeltsStudentStaff%}
    <h2> New Event Form</h2>
    {% endif %}
  </div>

  <form data-toggle="validator" role="form"  method="POST"
        {% if user.isCeltsAdmin or user.isCeltsStudentStaff%} action="/createEvent"
        {% else %}
          {% if userHasRSVPed %} action="/rsvpRemove"
          {% else %} action="/rsvpForEvent"
          {%endif%}
        {%endif%}>

    <div class="row">
      <div class="col-md-6 col-sm-12 ">
        <div>
          <input type="hidden" value="{{program.id}}" name="programId">

          <input type="hidden" name="eventId" value="{{eventId}}" >
        </div>
        <div class="d-grid gap-1.5">
          <div class="form-group">
            <label for='eventName'> <strong> Event Name * </strong></label> <br>
            <input class="form-control"  id='inputEventName' value="{{eventInfo.eventName}}" name="eventName"
                   {{'required' if user.isCeltsAdmin or user.isCeltsStudentStaff else 'readonly'}}>
          </div>
        </div><br>

        <div class="form-group">
          <label for='term'><strong> Term * </strong></label> <br>
          {% if user.isCeltsAdmin or user.isCeltsStudentStaff %}
            <select class="form-control" name='eventTerm' id='inputEventTerm' required>
              {%for term in listOfTerms %}
                {%if term.isCurrentTerm == 1%}
                  <option value='{{term}}' selected> {{term.description}} </option>
                {%else%}
                  <option value='{{term}}'> {{term.description}} </option>
                {%endif%}
              {% endfor %}
            </select>
          {% else %}
            <input class="form-control" id='term' name='eventTerm' value="{{eventInfo.term.description}}" readonly>
          {% endif %}
        </div><br>

        <div class="form-group">
          <label for='location'><strong>Location *</strong></label><br>
          <input class="form-control" id='inputEventLocation' value="{{eventInfo.location}}" name="eventLocation"
                 {{'required' if user.isCeltsAdmin or user.isCeltsStudentStaff else 'readonly'}}>

        </div> <br>
        {% if user.isCeltsAdmin or user.isCeltsStudentStaff%}
        <div class="form-check form-switch" style="padding-bottom: 1.5em">
          <label class="custom-control-label" for='checkIsRecurring'><strong>This event occurs every week</strong></label>
          <input class="form-check-input" type="checkbox" id="checkIsRecurring" name="eventIsRecurring"/>
        </div>
        {% endif %}

        <div class="flex-container"> <br>
          <div class="form-inline d-flex">
            <div  class="form-group" >
              <div class="d-inline-flex">
                <label for="startTime"><strong>Start Time: *</strong></label>
                <input type='time' class="form-control timePicker" id='pickStartTime'value="{{eventInfo.timeStart}}"  name="eventStartTime"
                       {{'required' if user.isCeltsAdmin or user.isCeltsStudentStaff else 'readonly'}}>
              </div>
              <div class='form-group time d-inline-flex' style="padding: 0 0 0 2rem">
                <label for="endTime"><strong>End Time: *</strong></label>
                <input type='time' class="form-control timePicker" id='pickEndTime' value="{{eventInfo.timeEnd}}" name="eventEndTime"
                       {{'required' if user.isCeltsAdmin or user.isCeltsStudentStaff else 'readonly'}}>
              </div>
            </div>
          </div>
        </div><br>

        <!-- datePickerS -->
        <div class="flex-container">
          <div>
            <div  class="form-group" >
              <div class="d-inline-flex" style="width:48%;">
              <!--datePicker for start date-->
              <label for="startDatePicker" id="startDatePickerLabel" ><span><strong>Start Date *</strong></span></label>
                <div class='input-group date' {{ 'id=startDate' if user.isCeltsAdmin or user.isCeltsStudentStaff }}>
                  <input type='text' class="form-control datePicker readonly" value="{{eventInfo.startDate}}" name="eventStartDate" placeholder="Start Date" onchange=updateDate(this) id=startDatePicker
                         {{'required' if user.isCeltsAdmin or user.isCeltsStudentStaff else 'readonly'}}>
                  <div class="input-group-text" id="calendarIconStart">
                    <span><i class="bi bi-calendar-plus-fill"></i></span>
                  </div>
                </div>
              </div>

              <div class="d-inline-flex" id ="endDateStyle" style="width:51%;">
                <!--datePicker for End date-->
                <label for="endDatePicker" id="endDatePickerLabel" style="padding:0 0 0 2rem" ><span><strong>End Date *</strong></span></label>
                <div class='input-group date' {{'id=endDate' if user.isCeltsAdmin or user.isCeltsStudentStaff }}>
                  <input type='text' class="form-control datePicker readonly" id='endDatePicker' name="eventEndDate" placeholder="End Date" onchange="updateDate(this)"
                        {{'required' if user.isCeltsAdmin or user.isCeltsStudentStaff else 'readonly'}}>

                  <div class="input-group-text" id="calendarIconEnd">
                    <span><i class="bi bi-calendar-plus-fill"></i></span>
                  </div>
                </div>
              </div>â€‹
            </div>
          </div>
        </div><br>
        <div class = "d-none" id ="recurringTableDiv">
          <table class="table" id="recurringEventsTable" name="recurringEventsTable">
            <thead>
            <tr>
            <th>Event Name</th>
            <th>Date</th>
            </tr>
            </thead>
            <tbody>
            </tbody>
          </table>

        </div>
      </div>

      <div class="col-md-6 col-sm-12 form-group">
        {% if user.isCeltsAdmin or user.isCeltsStudentStaff%}
        <div class="form-check form-switch">
          <label class="custom-control-label" for="checkIsRequired"><strong>This event is required for the program</strong></label>
          <input class="form-check-input" type="checkbox" id="checkIsRequired" name="eventRequiredForProgram"/>
        </div>

        <div class="form-check form-switch">
          <label class="custom-control-label" for="checkIsTraining"><strong>This event is a training for the program</strong></label>
          <input class="form-check-input" type="checkbox" id="checkIsTraining"  name="eventIsTraining"/>
        </div>

        <div class="form-check form-switch">
          <label class="custom-control-label" for='rsvp'><strong>Requires RSVP</strong></label>
          <input class="form-check-input" type="checkbox" id="rsvp"  name="eventRSVP"/>
        </div>

        <div class="form-check form-switch">
          <label class="custom-control-label"for='serviceHours'><strong> This event earns service hours.</strong></label>
          <input class="form-check-input" type="checkbox" id="earnServiceHours"  name="eventServiceHours" />
        </div><br>
        {% else %}
        <div>
          {%if eventInfo.isTraining%}
            <label> <strong> This event is a training for the program </strong> </label><br>
          {% endif %}
          {% if eventInfo.isRsvpRequired %}
            <label> <strong> Requires RSVP </strong> </label><br>
          {% endif %}
          {% if eventInfo.isService %}
            <label> <strong> This event earns service hours </strong> </label><br>
          {% endif %}

        </div><br>
        {% endif %}

        <div class="form-group">
          <label for='description'><strong> Description * </strong></label> <br>
          <textarea rows="5" cols="72" class="form-control" id='inputEventDescription' name="eventDescription"
                     {{'required' if user.isCeltsAdmin or user.isCeltsStudentStaff else 'readonly'}}>{{eventInfo.description if not user.isCeltsAdmin or user.isCeltsStudentStaff}}</textarea>
        </div><br>

        <div class='form-group'>
          <label for='facilitators'><strong> Facilitators *</strong></label> <br>

          {% if user.isCeltsAdmin or user.isCeltsStudentStaff%}
          <select class="dropdown form-control" id="inputEventFacilitators"  name="eventFacilitator">
            {%for facilitator in facilitators.objects() %}
              <option value={{facilitator.username}}> {{facilitator.firstName}} {{facilitator.lastName}}</option>
            {% endfor %}
          </select>
          {% else %}
          <input class="form-control"  id='inputEventName' value="{%for facilitator in eventFacilitators.objects() %} {{facilitator.user.firstName}} {{facilitator.user.lastName}}  {% endfor %}" name="facilitators" readonly>
          {% endif %}

      </div>
      </div>
      </div>
      <div class="row justify-content-left" style="margin-top: 1.5em">
      <div class="col-md-6 offset-md-3">
        <div class="text-center">
          {% if user.isCeltsAdmin or user.isCeltsStudentStaff%}
          <button type="submit" class="btn btn-primary">save</button>
          {% elif user.isStudent %}
            {% if userHasRSVPed %}
              <button type="submit" class="btn btn-danger" >Remove RSVP</button>
            {% else %}
              <button type="submit" class="btn btn-primary" >RSVP</button>
            {% endif %}
          {% endif %}
        </div>
      </div>
      </div>
</form>
{% endblock %}
