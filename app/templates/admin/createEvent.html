{% set title = "Create Single Event" %}
{% extends "base.html"%}

{% block scripts %}
  {{super()}}
  <script src="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>
  <script type="module" src="/static/js/createEvents.js"></script>
{% endblock %}

{% block styles %}
  {{super()}}
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">
{% endblock %}

{% block app_content %}


{% set isNewEvent = 'create' in request.path %}
<!-- Program manager isCeltsAdmin and they are a manager for the program  -->
<div class="text-center mt-5 mb-3">
    {% if isNewEvent %}
      {% if template.tag == 'single-program' %}
        {% set page_title = 'Create Event for ' + eventData["program"].programName %}
      {% elif template.tag == 'all-volunteer' %}
        {% set page_title = 'Create All Volunteer Training' %}
      {% elif template.tag == 'no-program' %}
        {% set page_title = 'Create Non-program Event' %}
      {% else %}
        {% set page_title = 'Create ' + template.name + ' Event' %}
      {% endif %}
      {% else %}
        {% set page_title = eventData.name %}
      {% endif %}
    <h1 id="title">{{page_title}}</h1>
    {% if isPastEvent %}
      <div class="alert alert-danger" role="alert">This event is in the past.</div>
    {% endif %}
</div>
{% if not isNewEvent %}
<div class="container">
    <div class="row align-items-start">
        <div class="btn-group col">
          <ul class="nav nav-tabs nav-fill mx-3 mb-3" id="pills-tab" role="tablist">
            <li class="nav-item" role="presentation">
                <a class="nav-link" href="/eventsList/{{eventData.id}}/view" role="tab" aria-selected="false">View Event</a></li>
            <li class="nav-item" role="presentation">
                <a class="nav-link" href="/eventsList/{{eventData.id}}/track_volunteers" role="tab" aria-selected="false">Track Volunteers</a></li>
            <li class="nav-item" role="presentation">
                <a class="nav-link active" href="#" role="tab" aria-selected="true">Edit Event</a></li>
         </ul>
        </div>
        <div class="col">
            <form action="/event/{{eventData.id}}/delete" method='post'>
                <input type="submit" class="btn btn-danger float-end" value="Delete Event"/>
              <div>
                <input type="hidden" value="{{eventData.id}}" name="id">
              </div>
           </form>
        </div>
     </div>
</div>
{% endif %}
<form id="saveEvent" data-toggle="validator" role="form" action="{{request.path}}" method="POST">
    <div class="row p-2">
        <div class="col-md-6">
            {% if eventData.id %}
                <input type="hidden" name="id" value="{{eventData.id}}">
            {% endif %}
        <div class="form-group mb-4">
          <label class="form-label" for='inputEventName'><strong>Event Name</strong></label>
          <input class="form-control" id='inputEventName' value="{{eventData.name}}" placeholder="Enter event name" name="name" required>
        </div>
        <div class="form-group mb-4">
          <label class="form-label" for='inputEventTerm'><strong>Term</strong></label>
            <select class="form-select" name='term' id='inputEventTerm' required>
              {% for term in futureTerms %}
                <option value='{{term}}' {{"selected" if term == eventData.term}}>{{term.description}}</option>
              {% endfor %}
            </select>
        </div>
        <div class="form-group mb-4">
          <label class="form-label" for='inputEventLocation'><strong>Location</strong></label>
          <input class="form-control" id='inputEventLocation' value="{{eventData.location}}" placeholder="Enter location" name="location" required>
        </div>
        {% if isNewEvent %}
        <div class="form-check form-switch pb-1">
          <label class="custom-control-label" for='checkIsRecurring'><strong>This is a recurring event.</strong></label>
          <input class="form-check-input" type="checkbox" id="checkIsRecurring" name="isRecurring"/>
        </div>
        {% endif %}
        <!-- Start and End Datepickers -->
        <div class="row col-md-12">
            <div class="form-group col-md-6">
                <label class="form-label me-2" for="startDatePicker"><strong>Start Date</strong></label>
                <div class='input-group date' id="startDate">
                    <input autocomplete="off" type='text' class="form-control datePicker readonly" value="{{ eventData.startDate.strftime('%m-%d-%Y') if eventData.startDate and eventData.startDate.strftime else eventData.startDate}}" name="startDate" placeholder="Pick a start date" id=startDatePicker required>
                    <div class="input-group-text" id="calendarIconStart">
                        <span><i class="bi bi-calendar-plus-fill"></i></span>
                    </div>
                </div>
            </div>
            <div class="form-group col-md-6 d-none" id ="endDateStyle">
            <!--datePicker for End date-->
                <label class="form-label" for="endDatePicker"><strong>End Date</strong></label>
                <div class='input-group date' id="endDate">
                  <input autocomplete="off" type='text' class="form-control datePicker readonly" id='endDatePicker' value="{{eventData.endDate.strftime('%m-%d-%Y') if eventData.endDate and eventData.endDate.strftime else eventData.endDate}}" name="endDate" placeholder="Pick an end date" {{"readonly" if not isEditable}}>
                  <div class="input-group-text" id="calendarIconEnd">
                    <span><i class="bi bi-calendar-plus-fill"></i></span>
                  </div>
                </div>
            </div>
        </div>
        <br>
        <!-- Start and End Time -->
        <div class="mb-4">
          <div class="row col-md-12" >
            <div class="form-group col-md-6">
              <label class="form-label me-2" for="startTime"><strong>Start Time</strong></label>
              <div class="input-group">
                {% if eventData.timeStart %}
                  {%set start_time = eventData.timeStart %}
                {%else%}
                  {%set start_time = "12:00" %}
                {% endif %}
                <input autocomplete="off" type="time" class="form-control timepicker readonly" value="{{start_time}}" name="timeStart" aria-describedby="timeIcon1" placeholder="Pick a start time" onchange="update(this)" id=startTime required />
                <span class="input-group-text timeIcons" id="timeIcon1" hidden><i class="bi bi-clock"></i></span>
              </div>
            </div>
            <div class='form-group col-md-6'>
              <label class="form-label me-2" for="pickEndTime"><strong>End Time</strong></label>
              <div class="input-group">
                {% if eventData.timeEnd %}
                  {%set end_time = eventData.timeEnd%}
                {%else%}
                  {%set end_time = "12:00" %}
                {% endif %}
                  <input autocomplete="off" type="time" class="form-control timepicker readonly" value="{{end_time}}" name="timeEnd" aria-describedby="timeIcon2" placeholder="Pick an end time" onchange="update(this)" id=endTime required />
                  <span class="input-group-text timeIcons" id="timeIcon2" hidden><i class="bi bi-clock"></i></span>
              </div>
            </div>
          </div>
        </div>
        <div class="d-none" id="recurringTableDiv">
          <table class="table" id="recurringEventsTable" name="recurringEventsTable">
            <thead><tr><th>Event Name</th><th>Date</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
    </div>
        <div class="col-md-6 form-group">
          <div class="form-group mb-4">
            <label class="form-label" for='inputEventDescription'><strong>Description</strong></label>
            <textarea rows="5" cols="72" class="form-control" id='inputEventDescription' placeholder="Enter event description" name="description" required>{{eventData.description}}</textarea>
          </div>
          <div class='form-group'>
            <label class="form-label" for='inputEventFacilitators'><strong>Facilitators</strong></label>
            <input class="form-control" type="text" id="hiddenFacilitatorArray" name="facilitators" value="" hidden>
            <input
              id="eventFacilitator"
              class="form-control"
              type="search"
              placeholder="Search facilitator"
              value="" />
            <table class="table mb-3" id="facilitatorTable" name="facilitatorTable">
              <thead>
                <tr>
                </tr>
              </thead>
              <tbody>
                <tr hidden>
                  <td>
                    <p class="facilitatorName mt-3" required></p>
                  </td>
                  <td><button id="remove" type="button" class="mt-3 btn btn-danger">Remove</button></td>

                </tr>
                {% for instructor in courseInstructor %}
                <tr>
                  <td>
                    <p class="facilitatorName">{{instructor.user.firstName}} {{instructor.user.lastName}} ({{instructor.user}})</p>
                  </td>
                  <td>
                    <button id="remove" type="button" class="btn btn-danger">Remove</button>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
           </div>
            {% if page_title != 'Create All Volunteer Training' %}
              <div class="form-check form-switch pt-4">
                <label class="custom-control-label" for="checkIsTraining"><strong>This event is a training.</strong></label>
                <input class="form-check-input" type="checkbox" id="checkIsTraining" name="isTraining" {{"checked" if eventData.isTraining}}/>
              </div>
              <div class="form-check form-switch">
                <label class="custom-control-label" for='rsvp'><strong>This event requires RSVP.</strong></label>
                <input class="form-check-input" type="checkbox" id="rsvp" name="isRsvpRequired" {{"checked" if eventData.isRsvpRequired}}/>
              </div>
              <div class="form-check form-switch mb-4">
                <label class="custom-control-label" for='earnServiceHours'><strong>This event earns service hours.</strong></label>
                <input class="form-check-input" type="checkbox" id="earnServiceHours" name="isService" {{"checked" if eventData.isService}}/>
              </div>
           {% endif %}
          </div>
        </div>
    <div class="row justify-content-left mt-2">
          <div class="col-md-6 offset-md-3">
            <div class="text-center">
              <input type="submit" class="btn btn-primary" value="Save" />
            </div>
          </div>
    </div>
</form>
{% endblock %}
